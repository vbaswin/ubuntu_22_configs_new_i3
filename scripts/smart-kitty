#!/bin/zsh

# Path specific to your machine
AC_ONLINE="/sys/class/power_supply/ACAD/online"

# Check if plugged in (1) or unplugged (0)
# Default to 0 (Battery) if the file can't be read
IS_PLUGGED_IN=0
if [ -f "$AC_ONLINE" ]; then
	IS_PLUGGED_IN=$(cat "$AC_ONLINE")
fi

if [ "$IS_PLUGGED_IN" -eq 1 ]; then
	# --- PLUGGED IN: PERFORMANCE MODE ---
	export __NV_PRIME_RENDER_OFFLOAD=1
	export __GLX_VENDOR_LIBRARY_NAME=nvidia
	export __VK_LAYER_NV_optimus=NVIDIA_only

	# Standard launch
	exec kitty "$@"
else
	# --- UNPLUGGED: BATTERY SAVER MODE ---
	unset __NV_PRIME_RENDER_OFFLOAD
	unset __GLX_VENDOR_LIBRARY_NAME
	unset __VK_LAYER_NV_optimus

	# Launch with internal power optimizations
	# repaint_delay=33  -> Caps rendering at ~30FPS (saves GPU cycles)
	# input_delay=3     -> Default is 3, keeping it ensures responsiveness
	# sync_to_monitor=no -> Prevents waiting for VSync (can reduce CPU wait times)
	exec kitty \
		-o repaint_delay=33 \
		-o cursor_blink_interval=0 \
		"$@"
fi
